<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Infinite Jazz Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.8.49/Tone.js"></script>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Courier New', monospace; 
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #eee; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            min-height: 100vh; 
            margin: 0;
            padding: 20px;
        }
        
        h1 { 
            color: #e94560; 
            text-shadow: 0 0 20px rgba(233, 69, 96, 0.5);
            margin-bottom: 5px;
            letter-spacing: 2px;
        }
        
        .progression { 
            color: #ffd369; 
            font-size: 14px; 
            margin-bottom: 20px;
            letter-spacing: 1px;
        }
        
        #controls { margin-bottom: 20px; text-align: center; }
        
        button { 
            padding: 12px 28px; 
            font-size: 16px; 
            cursor: pointer; 
            background: linear-gradient(135deg, #e94560, #ff6b6b); 
            border: none; 
            color: white; 
            border-radius: 25px;
            font-family: inherit;
            font-weight: bold;
            letter-spacing: 1px;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(233, 69, 96, 0.4);
        }
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(233, 69, 96, 0.6);
        }
        button.playing {
            background: linear-gradient(135deg, #c0392b, #e74c3c);
        }
        
        button.secondary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        button.secondary:hover {
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.6);
        }
        
        .button-row {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
        }
        
        .main-container {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            justify-content: center;
            max-width: 800px;
        }
        
        #display { 
            width: 280px; 
            min-height: 160px; 
            border: 2px solid #e94560; 
            background: rgba(0, 0, 0, 0.4); 
            padding: 25px; 
            display: flex; 
            flex-direction: column; 
            justify-content: center; 
            align-items: center; 
            text-align: center;
            border-radius: 15px;
            backdrop-filter: blur(10px);
        }
        
        .chord-display { 
            font-size: 42px; 
            font-weight: bold; 
            margin-bottom: 10px; 
            color: #ffd369;
            text-shadow: 0 0 15px rgba(255, 211, 105, 0.5);
        }
        .status { font-size: 13px; color: #888; }
        .note-log { font-size: 11px; color: #aaa; margin-top: 10px; height: 1.5em; }
        
        /* Configuration Panel */
        #config-panel {
            background: rgba(0, 0, 0, 0.4);
            border: 2px solid #4a5568;
            border-radius: 15px;
            padding: 20px;
            width: 320px;
            backdrop-filter: blur(10px);
        }
        
        .config-title {
            color: #e94560;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 15px;
            text-transform: uppercase;
            letter-spacing: 2px;
            border-bottom: 1px solid #4a5568;
            padding-bottom: 8px;
        }
        
        .config-group {
            margin-bottom: 18px;
        }
        
        .config-group label {
            display: block;
            font-size: 11px;
            color: #a0aec0;
            margin-bottom: 6px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .config-group select,
        .config-group input[type="range"] {
            width: 100%;
            background: #2d3748;
            border: 1px solid #4a5568;
            color: #eee;
            padding: 8px 10px;
            border-radius: 6px;
            font-family: inherit;
            font-size: 13px;
        }
        
        .config-group select:focus {
            outline: none;
            border-color: #e94560;
        }
        
        .config-group input[type="range"] {
            -webkit-appearance: none;
            height: 6px;
            padding: 0;
            cursor: pointer;
        }
        
        .config-group input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 16px;
            height: 16px;
            background: #e94560;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: #718096;
            margin-top: 4px;
        }
        
        .range-value {
            color: #ffd369;
            font-weight: bold;
        }
        
        .config-row {
            display: flex;
            gap: 12px;
        }
        
        .config-row .config-group {
            flex: 1;
        }
    </style>
</head>
<body>

<div id="controls">
    <h1>âˆ¿ Infinite Jazz Generator</h1>
    <p class="progression">Dm7 â†’ G7 â†’ Cmaj7 â†’ A7</p>
    <div class="button-row">
        <button id="startBtn">â–¶ Start Jazz</button>
        <button id="randomBtn" class="secondary">ðŸŽ² Random Style</button>
    </div>
</div>

<div class="main-container">
    <div id="display">
        <div class="chord-display" id="currentChord">â€”</div>
        <div class="status" id="phraseStatus">Waiting to swing...</div>
        <div class="note-log" id="noteLog"></div>
    </div>
    
    <div id="config-panel">
        <div class="config-title">âš™ Configuration</div>
        
        <div class="config-row">
            <div class="config-group">
                <label>Tempo (BPM)</label>
                <input type="range" id="tempoSlider" min="70" max="160" value="110">
                <div class="range-labels">
                    <span>70</span>
                    <span class="range-value" id="tempoValue">110</span>
                    <span>160</span>
                </div>
            </div>
            <div class="config-group">
                <label>Swing</label>
                <input type="range" id="swingSlider" min="0" max="50" value="30">
                <div class="range-labels">
                    <span>Straight</span>
                    <span class="range-value" id="swingValue">30%</span>
                    <span>Heavy</span>
                </div>
            </div>
        </div>
        
        <div class="config-group">
            <label>Comping Style</label>
            <select id="compStyle">
                <option value="whole">Whole Notes (Pad)</option>
                <option value="charleston" selected>Charleston (Jazz Standard)</option>
                <option value="bossa">Bossa Nova</option>
                <option value="driving">Driving Quarters</option>
                <option value="sparse">Sparse / Breathe</option>
                <option value="busy">Busy Bebop</option>
            </select>
        </div>
        
        <div class="config-group">
            <label>Melody Density</label>
            <select id="melodyDensity">
                <option value="sparse">Sparse (Space)</option>
                <option value="moderate" selected>Moderate</option>
                <option value="busy">Busy (Bebop)</option>
            </select>
        </div>
        
        <div class="config-row">
            <div class="config-group">
                <label>Lead Volume</label>
                <input type="range" id="leadVol" min="0" max="100" value="70">
                <div class="range-labels">
                    <span>0</span>
                    <span class="range-value" id="leadVolValue">70%</span>
                    <span>100</span>
                </div>
            </div>
            <div class="config-group">
                <label>Bass Volume</label>
                <input type="range" id="bassVol" min="0" max="100" value="65">
                <div class="range-labels">
                    <span>0</span>
                    <span class="range-value" id="bassVolValue">65%</span>
                    <span>100</span>
                </div>
            </div>
        </div>
        
        <div class="config-group">
            <label>Reverb Mix</label>
            <input type="range" id="reverbMix" min="0" max="80" value="35">
            <div class="range-labels">
                <span>Dry</span>
                <span class="range-value" id="reverbValue">35%</span>
                <span>Wet</span>
            </div>
        </div>
    </div>
</div>

<script>
/**
 * CONFIGURATION & THEORY
 */
const TEMPO = 110; // Slightly laid back
const LOOKAHEAD = 1.0; // Seconds to schedule ahead
const ROOT_MIDI = 60; // Middle C

// Musical Constants
const SCALES = {
    "C_MAJOR": [0, 2, 4, 5, 7, 9, 11], // C D E F G A B
    // A Phrygian Dominant (5th mode of D harmonic minor) for A7
    "A_PHRYGIAN_DOM": [9, 10, 1, 2, 4, 5, 7] // A Bb C# D E F G
};

const CHORD_PROGRESSION = [
    { name: "Dm7",   root: 2,  type: "m7",   scale: "C_MAJOR",        tones: [2, 5, 9, 0] },   // D F A C
    { name: "G7",    root: 7,  type: "7",    scale: "C_MAJOR",        tones: [7, 11, 2, 5] },  // G B D F
    { name: "Cmaj7", root: 0,  type: "maj7", scale: "C_MAJOR",        tones: [0, 4, 7, 11] },  // C E G B
    { name: "A7",    root: 9,  type: "7",    scale: "A_PHRYGIAN_DOM", tones: [9, 1, 4, 7] }    // A C# E G
];

// Melody Rhythm Patterns (1 = play, 0 = rest)
// 8 slots per bar (eighth notes)
const MELODY_RHYTHMS = {
    sparse: [
        [0,0, 1,0, 0,0, 1,0], // Very open
        [1,0, 0,0, 0,1, 0,0], // Minimal
        [0,0, 0,1, 0,0, 1,0], // Off-beat hits
    ],
    moderate: [
        [0,1, 1,0, 1,1, 1,0], // Syncopated
        [1,0, 1,0, 1,0, 1,0], // Walking
        [0,0, 1,0, 0,1, 1,0], // Spacey
        [1,0, 0,1, 1,0, 0,1], // Bouncy
    ],
    busy: [
        [1,1, 1,1, 0,1, 1,0], // Bebop run
        [1,1, 0,1, 1,1, 1,0], // Busy
        [1,1, 1,0, 1,1, 1,1], // Very active
        [0,1, 1,1, 1,1, 0,1], // Pickup run
    ]
};

// Comping Rhythm Patterns (chord voicings)
// Each pattern: array of { beat: 0-7 (eighth notes), duration: note length }
const COMP_PATTERNS = {
    whole: [
        [{ beat: 0, dur: "1n" }] // Whole note, simple pad
    ],
    charleston: [
        // Classic "Charleston" rhythm: beat 1 and the "and" of 2
        [{ beat: 0, dur: "4n" }, { beat: 3, dur: "8n" }],
        [{ beat: 0, dur: "8n" }, { beat: 3, dur: "4n" }],
        [{ beat: 0, dur: "4n" }, { beat: 3, dur: "8n" }, { beat: 6, dur: "8n" }],
    ],
    bossa: [
        // Bossa nova anticipated rhythm
        [{ beat: 0, dur: "8n" }, { beat: 3, dur: "8n" }, { beat: 6, dur: "8n" }],
        [{ beat: 0, dur: "8n" }, { beat: 2, dur: "8n" }, { beat: 5, dur: "8n" }],
    ],
    driving: [
        // Four-to-the-floor with accents
        [{ beat: 0, dur: "8n" }, { beat: 2, dur: "8n" }, { beat: 4, dur: "8n" }, { beat: 6, dur: "8n" }],
    ],
    sparse: [
        // Very minimal - just accents
        [{ beat: 0, dur: "2n" }],
        [{ beat: 4, dur: "2n" }],
        [{ beat: 0, dur: "4n" }],
    ],
    busy: [
        // Bebop style - more active
        [{ beat: 0, dur: "8n" }, { beat: 2, dur: "8n" }, { beat: 3, dur: "8n" }, { beat: 5, dur: "8n" }, { beat: 7, dur: "8n" }],
        [{ beat: 1, dur: "8n" }, { beat: 3, dur: "8n" }, { beat: 4, dur: "8n" }, { beat: 6, dur: "8n" }],
    ]
};

// Current configuration (reactive)
const CONFIG = {
    tempo: 110,
    swing: 0.3,
    compStyle: 'charleston',
    melodyDensity: 'moderate',
    leadVol: -8,
    bassVol: -6,
    reverbMix: 0.35
};

/**
 * AUDIO ENGINE (Tone.js wrapper)
 */
let synth, bassSynth, chordSynth;
let reverb, delay; // Store references for live control
let isPlaying = false;
let audioInitialized = false;

async function initAudio() {
    if (audioInitialized) return;
    
    await Tone.start();
    
    // Create effects chain FIRST (don't connect to destination individually)
    reverb = new Tone.Reverb({ decay: 2.5, wet: CONFIG.reverbMix });
    delay = new Tone.FeedbackDelay({ 
        delayTime: "8n.", // Dotted eighth for jazz feel
        feedback: 0.15,   // Subtle
        wet: 0.12 
    });
    
    // Master chain: delay -> reverb -> destination
    delay.connect(reverb);
    reverb.toDestination();
    
    // Separate dry path with less volume
    const dryGain = new Tone.Gain(0.7).toDestination();
    
    // 1. Lead Synth (Vibraphone/Electric Piano feel)
    // Use FM synthesis for bell-like vibraphone tone
    synth = new Tone.PolySynth(Tone.FMSynth, {
        harmonicity: 3.01,
        modulationIndex: 1.5,
        oscillator: { type: "sine" },
        modulation: { type: "sine" },
        envelope: { attack: 0.001, decay: 0.4, sustain: 0.15, release: 1.2 },
        modulationEnvelope: { attack: 0.002, decay: 0.2, sustain: 0, release: 0.3 },
        volume: CONFIG.leadVol
    });
    synth.connect(dryGain);
    synth.connect(delay); // Goes through delay -> reverb chain

    // 2. Comping Chords (Warm Rhodes-like) - only reverb, no delay
    chordSynth = new Tone.PolySynth(Tone.FMSynth, {
        harmonicity: 2,
        modulationIndex: 0.8,
        oscillator: { type: "sine" },
        modulation: { type: "triangle" },
        envelope: { attack: 0.02, decay: 0.8, sustain: 0.3, release: 1.5 },
        modulationEnvelope: { attack: 0.05, decay: 0.3, sustain: 0.2, release: 0.5 },
        volume: -16
    });
    chordSynth.connect(reverb); // Direct to reverb only
    
    // 3. Upright Bass - Clean MonoSynth with lowpass filter (NO MembraneSynth!)
    const bassFilter = new Tone.Filter({
        type: "lowpass",
        frequency: 800,
        rolloff: -24
    }).toDestination();
    
    bassSynth = new Tone.MonoSynth({
        oscillator: { type: "triangle" },
        envelope: { attack: 0.02, decay: 0.3, sustain: 0.6, release: 0.4 },
        filterEnvelope: {
            attack: 0.01,
            decay: 0.1,
            sustain: 0.5,
            release: 0.3,
            baseFrequency: 200,
            octaves: 2
        },
        volume: CONFIG.bassVol
    });
    bassSynth.connect(bassFilter); // Bass stays DRY (no reverb = tight low end)

    Tone.Transport.bpm.value = CONFIG.tempo;
    Tone.Transport.swing = CONFIG.swing;
    Tone.Transport.swingSubdivision = "8n";
    
    audioInitialized = true;
}

/**
 * GENERATOR LOGIC
 */

// Helper: MIDI handling
function getMidi(pc, octave) { return pc + (octave + 1) * 12; }
function randomEl(arr) { return arr[Math.floor(Math.random() * arr.length)]; }

// Helper: Find nearest note in a scale/chord array to a target pitch
function findNearest(target, pool) {
    return pool.reduce((prev, curr) => 
        Math.abs(curr - target) < Math.abs(prev - target) ? curr : prev
    );
}

// Global State
let lastNoteMidi = 72; // Start around C5

// The Core Generator Function
function generatePhrase(barIndex, time, chordIdx) {
    const chordDef = CHORD_PROGRESSION[chordIdx];
    
    // 1. Play Background Chord (Comping) with rhythmic patterns
    // Drop-2 voicing for openness
    const voicing = [
        getMidi(chordDef.tones[0], 3),      // Root stays
        getMidi(chordDef.tones[1], 2),      // 3rd dropped an octave  
        getMidi(chordDef.tones[2], 3),      // 5th stays
        getMidi(chordDef.tones[3], 3)       // 7th stays
    ];
    const chordFreqs = voicing.map(n => Tone.Frequency(n, "midi"));
    
    // Get comping pattern based on current style
    const compPatterns = COMP_PATTERNS[CONFIG.compStyle];
    const compPattern = randomEl(compPatterns);
    
    // Schedule each chord hit in the pattern
    compPattern.forEach(hit => {
        const hitTime = time + Tone.Time("8n").toSeconds() * hit.beat;
        // Vary velocity for groove
        const vel = 0.4 + Math.random() * 0.25;
        chordSynth.triggerAttackRelease(chordFreqs, hit.dur, hitTime, vel);
    });
    
    // 2. Walking Bass - Play on all 4 beats for authentic jazz feel
    const bassOctave = 2;
    const scale = SCALES[chordDef.scale];
    const rootMidi = getMidi(chordDef.root, bassOctave);
    
    // Beat 1: Root
    bassSynth.triggerAttackRelease(Tone.Frequency(rootMidi, "midi"), "8n", time);
    
    // Beat 2: 3rd or 5th (or passing tone)
    const beat2Choices = [chordDef.tones[1], chordDef.tones[2]];
    const beat2Note = getMidi(randomEl(beat2Choices), bassOctave);
    bassSynth.triggerAttackRelease(Tone.Frequency(beat2Note, "midi"), "8n", time + Tone.Time("4n").toSeconds());
    
    // Beat 3: 5th or a scale tone
    const fifthMidi = getMidi(chordDef.tones[2], bassOctave);
    bassSynth.triggerAttackRelease(Tone.Frequency(fifthMidi, "midi"), "8n", time + Tone.Time("4n").toSeconds() * 2);
    
    // Beat 4: Chromatic approach to next root (half step below or above)
    const nextChord = CHORD_PROGRESSION[(chordIdx + 1) % 4];
    const nextRoot = getMidi(nextChord.root, bassOctave);
    const approachNote = nextRoot + (Math.random() > 0.5 ? 1 : -1); // Chromatic neighbor
    bassSynth.triggerAttackRelease(Tone.Frequency(approachNote, "midi"), "8n", time + Tone.Time("4n").toSeconds() * 3);
    
    // Update UI
    Tone.Draw.schedule(() => {
        document.getElementById('currentChord').innerText = chordDef.name;
        document.getElementById('phraseStatus').innerText = "Improvising...";
    }, time);

    // 3. Generate Melody with configured density
    const melodyPatterns = MELODY_RHYTHMS[CONFIG.melodyDensity];
    const pattern = randomEl(melodyPatterns);
    
    // Convert generic pitch classes to actual MIDI pools
    const scalePool = SCALES[chordDef.scale].map(pc => getMidi(pc, 4)).concat(SCALES[chordDef.scale].map(pc => getMidi(pc, 5)));
    const chordPool = chordDef.tones.map(pc => getMidi(pc, 4)).concat(chordDef.tones.map(pc => getMidi(pc, 5)));
    
    // Guide Tones (3rd and 7th) for Voice Leading
    // 3rd is index 1, 7th is index 3 in our tones array
    const guideTones = [chordDef.tones[1], chordDef.tones[3]].map(pc => getMidi(pc, 4));

    pattern.forEach((step, index) => {
        if (step === 0) return; // Rest

        const beatOffset = index * 0.5; // Eighth notes
        const noteTime = time + Tone.Time("8n").toSeconds() * index;
        const isStrongBeat = (index === 0 || index === 4);
        
        // --- LOGIC IMPROVEMENT 1: Voice Leading ---
        // If it's the first note of the bar, try to resolve to a guide tone (3rd/7th)
        let targetPool = scalePool;
        let preferGuideTone = (index === 0 && Math.random() < 0.7); 

        if (preferGuideTone) {
            targetPool = guideTones;
        } else if (isStrongBeat) {
            targetPool = chordPool; // Prefer chord tones on beat 1 & 3
        } else {
            // Passing tones allowed, occasional chromaticism could be added here
            if (Math.random() < 0.1) {
                // simple chromatic: previous note +/- 1
                let chrom = lastNoteMidi + (Math.random() > 0.5 ? 1 : -1);
                targetPool = [chrom];
            }
        }

        // --- LOGIC IMPROVEMENT 2: Smooth Contours ---
        // Find note in pool closest to last note
        let note = findNearest(lastNoteMidi, targetPool);
        
        // Add some jumps for variety (15% chance)
        if (Math.random() < 0.15) {
            const jump = Math.random() > 0.5 ? 5 : 7; // 4th or 5th
            const dir = Math.random() > 0.5 ? 1 : -1;
            note = findNearest(lastNoteMidi + (jump*dir), targetPool);
        }

        // Keep in register (Middle C to E6)
        if (note < 60) note += 12;
        if (note > 80) note -= 12;

        lastNoteMidi = note;
        const velocity = 0.5 + Math.random() * 0.4; // Humanize velocity

        // Schedule Note
        synth.triggerAttackRelease(
            Tone.Frequency(note, "midi"), 
            "8n", 
            noteTime, 
            velocity
        );

        // UI Feedback
        Tone.Draw.schedule(() => {
            document.getElementById('noteLog').innerText = `MIDI: ${note}`;
        }, noteTime);
    });
}

/**
 * SCHEDULER
 */
let loop;

function startLoop() {
    let barCount = 0;
    
    // Loop every measure (1m)
    loop = new Tone.Loop((time) => {
        // Determine where we are in the 4-bar progression
        let progressionIndex = barCount % 4;
        
        generatePhrase(barCount, time, progressionIndex);
        
        barCount++;
    }, "1m").start(0);

    Tone.Transport.start();
    isPlaying = true;
}

function stopLoop() {
    if(loop) loop.dispose();
    Tone.Transport.stop();
    isPlaying = false;
    document.getElementById('currentChord').innerText = "â€”";
    document.getElementById('phraseStatus').innerText = "Stopped";
}

// UI Event Handlers
const startBtn = document.getElementById('startBtn');

startBtn.addEventListener('click', async () => {
    if (!isPlaying) {
        await initAudio();
        startLoop();
        startBtn.innerHTML = "â–  Stop Jazz";
        startBtn.classList.add('playing');
    } else {
        stopLoop();
        startBtn.innerHTML = "â–¶ Start Jazz";
        startBtn.classList.remove('playing');
    }
});

// Tempo Slider
const tempoSlider = document.getElementById('tempoSlider');
const tempoValue = document.getElementById('tempoValue');
tempoSlider.addEventListener('input', (e) => {
    CONFIG.tempo = parseInt(e.target.value);
    tempoValue.textContent = CONFIG.tempo;
    if (audioInitialized) {
        Tone.Transport.bpm.value = CONFIG.tempo;
    }
});

// Swing Slider
const swingSlider = document.getElementById('swingSlider');
const swingValue = document.getElementById('swingValue');
swingSlider.addEventListener('input', (e) => {
    CONFIG.swing = parseInt(e.target.value) / 100;
    swingValue.textContent = e.target.value + '%';
    if (audioInitialized) {
        Tone.Transport.swing = CONFIG.swing;
    }
});

// Comping Style
document.getElementById('compStyle').addEventListener('change', (e) => {
    CONFIG.compStyle = e.target.value;
});

// Melody Density
document.getElementById('melodyDensity').addEventListener('change', (e) => {
    CONFIG.melodyDensity = e.target.value;
});

// Lead Volume
const leadVolSlider = document.getElementById('leadVol');
const leadVolValue = document.getElementById('leadVolValue');
leadVolSlider.addEventListener('input', (e) => {
    const percent = parseInt(e.target.value);
    leadVolValue.textContent = percent + '%';
    // Convert 0-100 to dB scale (-30 to 0)
    CONFIG.leadVol = percent === 0 ? -Infinity : -30 + (percent / 100) * 30;
    if (synth) {
        synth.volume.value = CONFIG.leadVol;
    }
});

// Bass Volume  
const bassVolSlider = document.getElementById('bassVol');
const bassVolValue = document.getElementById('bassVolValue');
bassVolSlider.addEventListener('input', (e) => {
    const percent = parseInt(e.target.value);
    bassVolValue.textContent = percent + '%';
    CONFIG.bassVol = percent === 0 ? -Infinity : -30 + (percent / 100) * 30;
    if (bassSynth) {
        bassSynth.volume.value = CONFIG.bassVol;
    }
});

// Reverb Mix
const reverbSlider = document.getElementById('reverbMix');
const reverbValue = document.getElementById('reverbValue');
reverbSlider.addEventListener('input', (e) => {
    const percent = parseInt(e.target.value);
    reverbValue.textContent = percent + '%';
    CONFIG.reverbMix = percent / 100;
    if (reverb) {
        reverb.wet.value = CONFIG.reverbMix;
    }
});

/**
 * RANDOMIZE STYLE
 */
const compStyles = ['whole', 'charleston', 'bossa', 'driving', 'sparse', 'busy'];
const melodyDensities = ['sparse', 'moderate', 'busy'];

function randomInt(min, max) {
    return Math.floor(Math.random() * (max - min + 1)) + min;
}

function randomizeStyle() {
    // Tempo: 80-140 (reasonable jazz range, avoiding extremes)
    const newTempo = randomInt(80, 140);
    tempoSlider.value = newTempo;
    tempoValue.textContent = newTempo;
    CONFIG.tempo = newTempo;
    
    // Swing: 15-45% (always some swing, but not extreme)
    const newSwing = randomInt(15, 45);
    swingSlider.value = newSwing;
    swingValue.textContent = newSwing + '%';
    CONFIG.swing = newSwing / 100;
    
    // Comping Style: random
    const newCompStyle = compStyles[randomInt(0, compStyles.length - 1)];
    document.getElementById('compStyle').value = newCompStyle;
    CONFIG.compStyle = newCompStyle;
    
    // Melody Density: random
    const newMelodyDensity = melodyDensities[randomInt(0, melodyDensities.length - 1)];
    document.getElementById('melodyDensity').value = newMelodyDensity;
    CONFIG.melodyDensity = newMelodyDensity;
    
    // Lead Volume: 50-85% (always audible)
    const newLeadVol = randomInt(50, 85);
    leadVolSlider.value = newLeadVol;
    leadVolValue.textContent = newLeadVol + '%';
    CONFIG.leadVol = -30 + (newLeadVol / 100) * 30;
    
    // Bass Volume: 45-80%
    const newBassVol = randomInt(45, 80);
    bassVolSlider.value = newBassVol;
    bassVolValue.textContent = newBassVol + '%';
    CONFIG.bassVol = -30 + (newBassVol / 100) * 30;
    
    // Reverb: 15-60%
    const newReverb = randomInt(15, 60);
    reverbSlider.value = newReverb;
    reverbValue.textContent = newReverb + '%';
    CONFIG.reverbMix = newReverb / 100;
    
    // Apply to audio engine if running
    if (audioInitialized) {
        Tone.Transport.bpm.value = CONFIG.tempo;
        Tone.Transport.swing = CONFIG.swing;
        if (synth) synth.volume.value = CONFIG.leadVol;
        if (bassSynth) bassSynth.volume.value = CONFIG.bassVol;
        if (reverb) reverb.wet.value = CONFIG.reverbMix;
    }
}

// Random Style Button
document.getElementById('randomBtn').addEventListener('click', randomizeStyle);

// Randomize on page load for unique starting style
randomizeStyle();

</script>
</body>
</html>